
<!DOCTYPE HTML>
<html>
 <head>
   

<link type="text/css" href="/site_static/css/booki.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/base/jquery.ui.all.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/smoothness/jquery.ui.all.css" rel="Stylesheet" >
<script type="text/javascript" src="/site_static/js/jquery/jquery-1.4.4.js"></script>
<script type="text/javascript" src="/site_static/js/jquery/ui/jquery-ui-1.8.10.custom.js"></script>
<script type="text/javascript" src="/site_static/js/jquery.json-1.3.js"></script>
<script type="text/javascript" src="/site_static/js/booki.js"></script>
<script src="/site_static/js/messaging.js" type="text/javascript"></script>   
<script type="text/javascript" src="/site_static/js/general.js"></script>
<link href="/site_static/css/jquery.bubblepopup.v2.3.1.css" rel="stylesheet" type="text/css" />
<link type="text/css" href="/site_static/css/jquery-ui_overrides.css" rel="Stylesheet" >
<script src="/site_static/js/jquery.bubblepopup.v2.3.1.min.js" type="text/javascript"></script>

<link rel="SHORTCUT ICON" href="http://write.flossmanuals.net/site_static/images/favicon.ico" type="image/x-icon">
<meta property="og:site_name" content="FLOSS Manuals"/><meta name="description" content="Free Manuals for Freedom"/>

<script type="text/javascript">
  $(function() {
      $.booki.sputnikDispatcherURL = "/_sputnik/";

      $("#dialog-sputnik-error").dialog({
          modal: true,
          autoOpen: false,
          buttons: {
            Ok: function() {
               $(this).dialog('close');
               window.location = '.';
            }
          }
      });
  
      $("FORM.messagefield").messagefield('init', {'view_post': '/messaging/post' });  
  });
</script>


   
<title>/chapter: Scripting / COMMAND LINE</title>
<link type="text/css" href="/site_static/css/published.css" rel="Stylesheet" />

<link rel="alternate" type="application/rss+xml" title="RSS feed for COMMAND LINE" href="/feeds/rss/book/command-line/" /> 
<link rel="alternate" type="application/atom+xml" title="Atom feed for COMMAND LINE" href="/feeds/atom/book/command-line/" /> 

<link rel="alternate" type="application/rss+xml" title="RSS feed for chapter SCRIPTING" href="/feeds/rss/chapter/command-line/command-line/" /> 
<link rel="alternate" type="application/atom+xml" title="Atom feed for chapter SCRIPTING" href="/feeds/atom/chapter/command-line/command-line/" /> 


<style>
SPAN.bookicommentmarker {
  background-color: white;
}

SPAN.bookicommentmarker > IMG.markerimage { 
   display: none;
}


</style>



   <link type="text/css" href="/static/css/_user.css" rel="Stylesheet" >
 </head>
<body>

<div class="topbar"> 
  <div class="logotext"><a href="http://write.flossmanuals.net/">FLOSS Manuals</a> </div>

  <div class="meta-bar">
    
    <ul>
      <li>
        <a href="/accounts/signin/?redirect=/command-line/scripting/">Sign In / Create Account</a>
      </li>
    </ul>
    
    <div style="padding-top: 10px; padding-right: 15px;">
      <br/>
      

<script>
  $(function() {
    var $frm = $("FORM[name=changelang]");
	
    $("A[href=#]", $frm).click(function() {
        var lang = $(this).attr("class").substr(4);
	
        $("INPUT[name=language]", $frm).val(lang);
        $frm.submit();
	
        return false;
    });
  });
 </script>

<form name="changelang" method="POST" action="/accounts/i18n/setlang/?language=en-us">
  <input type="hidden" name="language" value="en-us">
  
    &nbsp;English&nbsp;|
  
  
  
    &nbsp;<a class="langes" href="#">Español</a>&nbsp;|
  

  
    &nbsp;<a class="langfr" href="#">Français</a>&nbsp;|
  
	
  
    &nbsp;<a class="langit" href="#">Italiano</a>&nbsp;|
  
	
  
    &nbsp;<a class="langpt" href="#">Português</a>&nbsp;|
  
	
  
    &nbsp;<a class="langru" href="#">Русский</a>&nbsp;|
  
	
  
    &nbsp;<a class="langsq" href="#">Shqip</a>
  	
</form>

    </div>
    
    
  </div><!-- End of .meta-bar -->
</div><!-- End top bar -->

<div class="menubar shadow">
  
  
  <div class="navbox">
    <ul>
      <li><a href="/list-books/">Books</a></li>
      <li><a href="/list-groups/">Groups</a></li>
      <li><a href="/list-people/">People</a></li>
    </ul>      
  </div><!-- End of .navbox -->       
</div>

<div class="content-container">
  <div class="content shadow">
    <!-- Content box and the drop shadow-->
    
   <h2>COMMAND LINE</h2>

<div class="padded">
<div id="bookmenu">
<ul>

 
   <li><b>INTRODUCTION</b></li>
 

 
   <li><a href="/command-line/introduction/">INTRODUCTION</a></li>
 

 
   <li><a href="/command-line/about-this-manual/">ABOUT THIS  MANUAL</a></li>
 

 
   <li><b>BASICS</b></li>
 

 
   <li><a href="/command-line/getting-started/">GETTING STARTED</a></li>
 

 
   <li><a href="/command-line/beginning-syntax/">BEGINNING SYNTAX</a></li>
 

 
   <li><a href="/command-line/moving-around/">MOVING AROUND</a></li>
 

 
   <li><b>COMMANDS</b></li>
 

 
   <li><a href="/command-line/basic-commands/">BASIC COMMANDS</a></li>
 

 
   <li><a href="/command-line/standard-files/">STANDARD FILES</a></li>
 

 
   <li><a href="/command-line/cut-down-on-typing/">CUT DOWN ON TYPING</a></li>
 

 
   <li><a href="/command-line/superusers/">SUPERUSERS</a></li>
 

 
   <li><a href="/command-line/redirection/">REDIRECTION</a></li>
 

 
   <li><b>ADVANCED-ISH</b></li>
 

 
   <li><a href="/command-line/multiple-files/">MULTIPLE FILES</a></li>
 

 
   <li><a href="/command-line/searching-for-files/">SEARCHING FOR FILES</a></li>
 

 
   <li><a href="/command-line/piping/">PIPING</a></li>
 

 
   <li><a href="/command-line/processes/">PROCESSES</a></li>
 

 
   <li><a href="/command-line/file-structure/">FILE STRUCTURE</a></li>
 

 
   <li><a href="/command-line/command-history/">COMMAND HISTORY</a></li>
 

 
   <li><b>ADVANCED</b></li>
 

 
   <li><a href="/command-line/permissions/">PERMISSIONS</a></li>
 

 
   <li><a href="/command-line/interactive-editing/">INTERACTIVE EDITING</a></li>
 

 
   <li><a href="/command-line/checking-exit/">CHECKING EXIT</a></li>
 

 
   <li><a href="/command-line/sub-commands/">SUB COMMANDS</a></li>
 

 
   <li><a href="/command-line/moving-again/">MOVING AGAIN</a></li>
 

 
   <li><a href="/command-line/customisation/">CUSTOMISATION</a></li>
 

 
   <li><a href="/command-line/parameter-substitution/">PARAMETER SUBSTITUTION</a></li>
 

 
   <li><a href="/command-line/gnuscreen/">GNUSCREEN</a></li>
 

 
   <li><a href="/command-line/ssh/">SSH</a></li>
 

 
   <li><a href="/command-line/installing-software/">INSTALLING SOFTWARE</a></li>
 

 
   <li><a href="/command-line/making-your-own-interpreter/">MAKING YOUR OWN INTERPRETER</a></li>
 

 
   <li><b>TEXT EDITORS</b></li>
 

 
   <li><a href="/command-line/text-editors/">TEXT EDITORS</a></li>
 

 
   <li><a href="/command-line/nano/">NANO</a></li>
 

 
   <li><a href="/command-line/vim/">VIM</a></li>
 

 
   <li><a href="/command-line/emacs/">EMACS</a></li>
 

 
   <li><a href="/command-line/kedit/">KEDIT</a></li>
 

 
   <li><a href="/command-line/gedit/">GEDIT</a></li>
 

 
   <li><b>SCRIPTING</b></li>
 

 
   <li><a href="/command-line/scripting/">SCRIPTING</a></li>
 

 
   <li><a href="/command-line/maintaining-scripts/">MAINTAINING SCRIPTS</a></li>
 

 
   <li><a href="/command-line/other-languages/">OTHER LANGUAGES</a></li>
 

 
   <li><a href="/command-line/sed/">SED</a></li>
 

 
   <li><a href="/command-line/awk/">AWK</a></li>
 

 
   <li><a href="/command-line/regular-expressions/">REGULAR EXPRESSIONS</a></li>
 

 
   <li><b>SCRIPTING LANGUAGES</b></li>
 

 
   <li><a href="/command-line/perl/">PERL</a></li>
 

 
   <li><a href="/command-line/python/">PYTHON</a></li>
 

 
   <li><a href="/command-line/ruby/">RUBY</a></li>
 

 
   <li><a href="/command-line/gnu-octave/">GNU OCTAVE</a></li>
 

 
   <li><b>APPENDICES</b></li>
 

 
   <li><a href="/command-line/glossary/">GLOSSARY</a></li>
 

 
   <li><a href="/command-line/command-quickie/">COMMAND QUICKIE</a></li>
 

 
   <li><a href="/command-line/outline/">OUTLINE</a></li>
 

 
   <li><a href="/command-line/credits/">CREDITS</a></li>
 

</ul>
</div>
<div id="bookcontent">
   
<html dir="LTR"><head><title>CommandLineIntro: Scripting</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body>
<h1>Scripting
</h1>
<p> If you have a collection of commands you'd like to run together, you can combine them in a script and run them all at once. You can also pass arguments to the script so that it can operate on different files or other input.
  <br></p>
<p>Like an actor reading a movie script, the computer runs each command in your shell script, without waiting for you to whisper the next line in its ear. A script is a handy way to:
</p>
<ul><li>Save yourself typing on a group of commands you often run together.
  <br></li>
  <li>Remember complicated commands, so you don't have to look up, or risk forgetting, the particular syntax each time you use it.</li>
  <li>Use control structures, like loops and case statements, to allow your scripts to do complex jobs. Writing these structures into a script can make them more convenient to type and easier to read. </li>
</ul><p>Let's say you often have collections of images (say, from a digital camera) that you would like to make thumbnails of. Instead of opening hundreds of images in your image editor, you choose to do the job quickly from the command line. And because you may need to do this same job in the future, you might write a script. This way, the job of making thumbnails takes you only two commands:
</p>
<pre>$ <strong>cd images/digital_camera/vacation_pictures_March_2009</strong>
$ <strong>make_thumbnails.sh</strong></pre>
<p>The second command, <code>make_thumbnails.sh</code>, is the script that does the job. You have made it previously and it resides in a directory on your search path. It might look something like this:
  <br></p>
<pre>#!/bin/bash
# This makes a directory containing thumnails of all the jpegs in the current dir.
mkdir thumbnails
cp *.jpg thumbnails
cd thumbnails
mogrify -resize 400x300 *.jpg</pre>
<p>If the first line begins with #! (pronounced "shee-bang"), it tells the kernel what interpreter is to be used. (Since bash is usually the default, you might omit this line). After this you should put in some comments about what the script is for and how to use it . Scripts without clear and complete usage instructions often do not "work right". For bash, comments start with the hash (#) character and may be on the ends of executable lines.
  <br></p>
<p>The file includes commands conforming to the syntax of the interpreter. We've seen three of them before: <code>mkdir</code>, <code>cp</code>, and <code>cd</code>. The last command, <code>mogrify</code>, is a program that can resize images (and do a lot of other things besides). Read its manual page to learn more about it.
  <br></p>
<h2>Making scripts executable
</h2>
<p> To write a script like the one we've shown, open your favorite text editor and type in the commands you would like to run. For bash, you can put multiple commands on a single line so long as you put a semi-colon after each command so the shell knows a new command is starting.
  <br></p>
<p>Save the script. One common convention for bash is to use the <code>.sh</code> extension -- for example, <em>make_thumbnails.sh</em>.
</p>
<p> There is one more step before you can run the script: it has to be <em>executable</em>. Remember from the section on permissions that executability is one of the permissions a file can have, so you can make your script executable by granting the execute (<strong>x</strong>) permission. The following command allows any user to execute the script:
</p>
<pre>$<strong> chmod +x make_thumbnails.sh</strong>
</pre>
<p>Because you're probably planning to use the script often, you'll find it worthwhile to check your PATH and add the script to one of the directories in it (for instance, <em>/home/jdoe/bin</em> is an easy choice given the PATH shown here).
  <br></p>
<pre>$ <strong>echo $PATH</strong>
/usr/bin:/usr/local/bin:/home/jdoe/bin</pre>
<p>For simple testing, if you're in the directory that contains the script, you can run it like this:
</p>
<pre>$ <strong>./make_thumbnails.sh</strong></pre>
<p> Why do you need the preceding ./ path? Because most users don't have the current directory in their PATH environment variables. You can add it, but some users consider that a security risk.
</p>
<p>Finally, you can also execute a script, even without its execute bit set, by passing it as an argument to the command interpreter, thusly:
</p>
<pre>$<strong> bash make_thumbnails.sh</strong></pre>
<h2>More control
</h2>
<p>To provide the flexibility you want, the bash shell and many other interpreters let you make choices in a script and run things repeatedly on a variety of inputs. In that regard, the shell is actually a programming language, and a nice way to get used to using the powerful features a programming language provides. We'll get you started here and show you the kinds of control the bash shell provides through compound statements.
  <br></p>
<h3>if
</h3>
<p>This statement was already introduced in the section on checking for errors, but we'll review it here. <code>if</code> is more or less what you'd expect, though its syntax is quite a bit different from its use in most other languages. It follows this form:
</p>
<pre>if [ <em>test-condition</em> ]
then
  <em>do-something</em>
else
  <em>do-something-else</em>
fi
</pre>
<p>You read that right: the block must be terminated with the keyword <code>fi</code>.  (It's one of the things that makes using <code>if</code> fun.) The <code>else</code> portion is optional. Make sure to leave spaces around the opening and closing brackets; otherwise <code>if</code> reports a syntax error.
  <br></p>
<p>For example, if you need to check to see if you can read a file, you could write a chunk like this:
</p>
<pre>if [ -r /home/joe/secretdata.txt ]
then
    echo "You can read the file"
else
    echo "You can't read that file!"
fi
</pre>
<p>
</p>
<p><code>if</code> accepts a wide variety of tests. You can put any set of commands as the <em>test-condition</em>, but most <code>if</code> statements use the tests provided by the square bracket syntax. These are actually just a synonym for a command named <code>test</code>. So the first line of the preceding example could just as well have been written as follows.
</p>
<pre>if test -r /home/joe/secretdata.txt
</pre>
<p>You can find out more about tests such as <code>-r</code> in the manual page for <code>test</code>. All the test operators can be used with square brackets, as we have.
</p>
<p>Some useful <code>test</code> operators are:
  <br><br></p>
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>-r</td>
    <td>File is readable</td>
  </tr><tr><td>-x</td>
    <td>File is executable</td>
  </tr><tr><td>-e</td>
    <td>File exists</td>
  </tr><tr><td>-d</td>
    <td>File exists and is a directory</td>
  </tr></tbody></table><p>There are many, many more of them, and you can even test for multiple conditions at once. See the the manual page for <code>test</code>.
</p>
<h3>while (and until)
  <br></h3>
<p><code>while</code> is a loop control structure. It keeps cycling through until its test condition is no longer true. It takes the following form:
</p>
<pre>while <em>test-condition</em>
do
  <em>step1</em>
  <em>step2</em>
  ...
done
</pre>
<p>You can also create loops that run until they are interrupted by the user. For example, this is one way (though not necessarily the best one) to look at who is logged into your system once every 30 seconds:
  <br></p>
<pre>while true
do
    who
    sleep 30
done
</pre>
<p>This is inelegant because the user has to press <strong>Ctrl + c</strong> or kill it in some other way. You can write a loop that ends when it encounters a condition by using the <code>break</code> command. For instance the following script uses the <code>read</code> command (quite useful in interactive scripts) to read a line of input from the user. We store the input in a variable named <em>userinput</em> and check it in the next line. The script uses another compound command we've already seen, <code>if</code>, within the <code>while</code> block, which allows us to decide whether to finish the <code>while</code> block. The <code>break</code> command ends the <code>while</code> block and continues with the rest of the script (not shown here). Notice that we use two tests through <code>-o</code>, which means "or". The user can enter <strong>Q</strong> in either lowercase or uppercase to quit.
  <br></p>
<pre>while true
do
  echo "Enter input to process (enter Q to quit)"
  read userinput

  if [ $userinput == "q" -o $userinput == "Q" ]
  then
    break
  fi

  <em>process input...</em>

done
</pre>
<p><code>until </code>works exactly the same way, except that the loop runs until the test condition becomes true.
  <br></p>
<h3>case
</h3>
<p><code>case</code> is a way for a script to respond to a set of test conditions. It works similarly to case statements in other programming languages, though it has its own peculiar syntax, which is best illustrated through an example.
</p>
<pre>user=`whoami` # puts the username of the user executing the script
              # into the $user variable.
case $user in
    joe)
        echo "Hello Joe. I know you'd like to know what time it is, so I'll show you below."
        date
        ;;
    amy)
        echo "Good day, Amy. Here's your todo list."
        cat /home/amy/amy-todo.txt
        ;;
    sam|tex)
        echo "Hi fella. Don't forget to watch the system load. The current system load is:"
        uptime
        ;;
    *)
        echo "Welcome, whoever else you are. Get to work now, please."
        ;;
esac
</pre>
<p>Each case must be followed by the ) character, then a newline, then the list of steps to take, then a double semicolon (;;). The "*)" condition is a catchall, similar to the <code>default</code> keyword in some languages' <code>case</code> structures. If no other cases match, the shell executes this list of statements. Finally, the keyword <code>esac</code> ends the <code>case</code> statement. In the example shown, note the case that matches either the string "sam" or "tex". 
</p>
<h3>for
</h3>
<p><code>for</code> is a useful way of iterating through items in a list. It can be any list of strings, but it's particularly useful for iterating through a file list. The following example iterates through all of the files in the directory <em>myfiles</em> and creates a backup file for each one. (It would choke on any directories, but let's keep the example simple and not test for whether the file is a directory.) ⁞
  <br></p>
<pre>for filename in myfiles/*
do
    cp $filename $filename.bak
done
</pre>
<p>As with any command that sets a variable, the first line of the <code>for</code> block sets the variable called <em>filename</em> without a dollar sign.
</p>
<p>There's another variety of <code>for</code>, which is similar to the <code>for</code> construct used in other languages, but which is used less in shell scripting than it's used in other languages, partially because the syntax for incrementing and decrementing variables in the shell is not entirely straightforward.
</p>
<h3>parallel
</h3>
<p><code>parallel</code> is a useful way of iterating through items in a list while maximizing the use of your computer by running jobs in parallel. The following example iterates through all of the files in the directory <em>myfiles</em> and creates a backup file for each one replacing the extension with <code>.bak</code>. (It would choke on any directories, but let's keep the example simple and not test for whether the file is a directory.)
  <br></p>
<pre>ls myfiles/* | parallel cp {} {.}.bak
</pre>
<p><code>parallel</code> can often be used instead of <code>for</code> loops and <code>while read</code> loops, make these run faster by running them in parallel and make the code easier to read.
</p>
<p><code>parallel</code> can be used for a lot of more advanced features. You can watch an intro video here: <a href="http://www.youtube.com/watch?v=OpaiGYxkSuQ" target="_top">http://www.youtube.com/watch?v=OpaiGYxkSuQ</a>
</p>
<p>
  <br></p>
</body></html>
   

</div>
</div>

  </div>
</div>
<!-- End of content -->



<!-- sputnik error page -->
<div id="dialog-sputnik-qrac" style="display: none"></div>
<div id="dialog-sputnik-error" title="Can't communicate with booktype">
  <p>
    <span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
    There has been error in communication with Booktype server.
    Not sure right now where is the problem.
  </p>
  <p>
    You should refresh this page.
  </p>
</div>


<ul class="strings template">
 <li class="ok">OK</li>
 <li class="back">Back</li>
 <li class="create">Create</li>
 <li class="cancel">Cancel</li>
 <li class="next">Next</li>
 <li class="import">Import</li>
 <li class="savechanges">Save changes</li>
 <li class="errorcreategroup">Couldn't create a group!</li>
 <li class="msgepub">enter epub URL</li>
 <li class="msgarchive">enter Archive.org ID</li>
 <li class="msgwiki">enter Wikibooks URL</li>
 <li class="msgbooktype">enter Booktype URL</li>
 <li class="deletebook">Delete book</li>
</ul>

</body>
</html>

