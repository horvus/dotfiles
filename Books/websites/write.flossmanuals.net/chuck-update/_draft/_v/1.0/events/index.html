
<!DOCTYPE HTML>
<html>
 <head>
   

<link type="text/css" href="/site_static/css/booki.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/base/jquery.ui.all.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/smoothness/jquery.ui.all.css" rel="Stylesheet" >
<script type="text/javascript" src="/site_static/js/jquery/jquery-1.4.4.js"></script>
<script type="text/javascript" src="/site_static/js/jquery/ui/jquery-ui-1.8.10.custom.js"></script>
<script type="text/javascript" src="/site_static/js/jquery.json-1.3.js"></script>
<script type="text/javascript" src="/site_static/js/booki.js"></script>
<script src="/site_static/js/messaging.js" type="text/javascript"></script>   
<script type="text/javascript" src="/site_static/js/general.js"></script>
<link href="/site_static/css/jquery.bubblepopup.v2.3.1.css" rel="stylesheet" type="text/css" />
<link type="text/css" href="/site_static/css/jquery-ui_overrides.css" rel="Stylesheet" >
<script src="/site_static/js/jquery.bubblepopup.v2.3.1.min.js" type="text/javascript"></script>

<link rel="SHORTCUT ICON" href="http://write.flossmanuals.net/site_static/images/favicon.ico" type="image/x-icon">
<meta property="og:site_name" content="FLOSS Manuals"/><meta name="description" content="Free Manuals for Freedom"/>

<script type="text/javascript">
  $(function() {
      $.booki.sputnikDispatcherURL = "/_sputnik/";

      $("#dialog-sputnik-error").dialog({
          modal: true,
          autoOpen: false,
          buttons: {
            Ok: function() {
               $(this).dialog('close');
               window.location = '.';
            }
          }
      });
  
      $("FORM.messagefield").messagefield('init', {'view_post': '/messaging/post' });  
  });
</script>


   
 <title>/chapter: Events / chuck update</title>
 <link type="text/css" href="/site_static/css/draft.css" rel="Stylesheet" />

 <link rel="alternate" type="application/rss+xml" title="RSS feed for chuck update" href="/feeds/rss/book/chuck-update/" /> 
 <link rel="alternate" type="application/atom+xml" title="Atom feed for chuck update" href="/feeds/atom/book/chuck-update/" /> 

 <link rel="alternate" type="application/rss+xml" title="RSS feed for chapter Events" href="/feeds/rss/chapter/chuck-update/chuck-update/" /> 
 <link rel="alternate" type="application/atom+xml" title="Atom feed for chapter Events" href="/feeds/atom/chapter/chuck-update/chuck-update/" /> 
 
 <script type="text/javascript" src="/site_static/js/draft.js"></script>


   <link type="text/css" href="/static/css/_user.css" rel="Stylesheet" >
 </head>
<body>

<div class="topbar"> 
  <div class="logotext"><a href="http://write.flossmanuals.net/">FLOSS Manuals</a> </div>

  <div class="meta-bar">
    
    <ul>
      <li>
        <a href="/accounts/signin/?redirect=/chuck-update/_draft/_v/1.0/events/">Sign In / Create Account</a>
      </li>
    </ul>
    
    <div style="padding-top: 10px; padding-right: 15px;">
      <br/>
      

<script>
  $(function() {
    var $frm = $("FORM[name=changelang]");
	
    $("A[href=#]", $frm).click(function() {
        var lang = $(this).attr("class").substr(4);
	
        $("INPUT[name=language]", $frm).val(lang);
        $frm.submit();
	
        return false;
    });
  });
 </script>

<form name="changelang" method="POST" action="/accounts/i18n/setlang/?language=en-us">
  <input type="hidden" name="language" value="en-us">
  
    &nbsp;English&nbsp;|
  
  
  
    &nbsp;<a class="langes" href="#">Español</a>&nbsp;|
  

  
    &nbsp;<a class="langfr" href="#">Français</a>&nbsp;|
  
	
  
    &nbsp;<a class="langit" href="#">Italiano</a>&nbsp;|
  
	
  
    &nbsp;<a class="langpt" href="#">Português</a>&nbsp;|
  
	
  
    &nbsp;<a class="langru" href="#">Русский</a>&nbsp;|
  
	
  
    &nbsp;<a class="langsq" href="#">Shqip</a>
  	
</form>

    </div>
    
    
  </div><!-- End of .meta-bar -->
</div><!-- End top bar -->

<div class="menubar shadow">
  
  
  <div class="navbox">
    <ul>
      <li><a href="/list-books/">Books</a></li>
      <li><a href="/list-groups/">Groups</a></li>
      <li><a href="/list-people/">People</a></li>
    </ul>      
  </div><!-- End of .navbox -->       
</div>

<div class="content-container">
  <div class="content shadow">
    <!-- Content box and the drop shadow-->
    

<h2>chuck update</h2>
<div class="padded">
 <div id="bookmenu" style="background: url(/site_static/images/draft_bg.png) repeat !important;"> 
  <ul>
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/introduction/">Introduction</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/places/">Places</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/authors/">Authors</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/installation/">Installation</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/tutorials/">Tutorials</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/hello-chuck/">Hello ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/conventions/">Conventions</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/on-the-fly-programming/">On-the-fly Programming</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/modifying-basic-patches/">Modifying Basic Patches</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/lfos-and-blackholes/">LFOs and Blackholes</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/working-with-midi/">Working with MIDI</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/writing-to-disk/">Writing to Disk</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/stereo/">Stereo</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/using-osc-in-chuck/">Using OSC in ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/reference/">Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/overview/">Overview</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/the-chuck-compiler-and-virtual-machine/">The ChucK Compiler and Virtual Machine</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/on-the-fly-commands/">On-the-fly Commands</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/types-values-and-variables/">Types, Values and Variables</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/operators-and-operations/">Operators and Operations</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/time-and-timing/">Time and Timing</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/concurrency-and-shreds/">Concurrency and Shreds</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/events/">Events</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/control-structures/">Control Structures</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/functions/">Functions</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/objects/">Objects</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/arrays/">Arrays</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-analyzers/">Unit Analyzers</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/standard-libraries/">Standard Libraries</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/event-reference/">Event Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/other-objects-reference/">Other Objects Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugenreference/">UgenReference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-generators/">Unit Generators</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugens-oscillators/">Ugens: Oscillators</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugens-stkinstruments/">Ugens: STKInstruments</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-analyzer-reference/">Unit Analyzer Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/extending-chuck/">Extending ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/lick-library-for-chuck/">LiCK: Library for ChucK</a></li>
    
   
  </ul>
 </div>
 <div id="bookcontent"   style="background: url(/site_static/images/draft_bg.png) repeat !important;">
   

  <html lang="en"><head><title>Events</title></head><body><h1>Events
</h1>
<p> In addition to the built-in timing mechanisms for internal control, ChucK has an event class to allow exact synchronization across an arbitrary number of shreds.
</p>
<h2>What they are
</h2> ChucK events are a native class within the ChucK language. We can create an event objects, and then chuck (=&gt;) that event to now. The event places the current shred on the event's waiting list, suspends the current shred (letting time advance from that shred's point of view). When the the event is triggered, one or more of the shreds on its waiting list is shreduled to run immediately. This trigger may originate from another ChucK shred, or from activities taking place outside the Virtual Machine ( MIDI, OSC, or IPC ).
<pre>    // declare event
    Event e;

    // function for shred
    fun void eventshred( Event event, string msg )
    {
        // infinite loop
        while ( true )
        {
            // wait on event
            event =&gt; now;
            // print
            &lt;&lt;&gt;&gt;;
        }
   }

    // create shreds
    spork   eventshred ( e, "fee" );
    spork   eventshred ( e, "fi" );
    spork   eventshred ( e, "fo" );
    spork   eventshred ( e, "fum" );

    // infinite time loop
    while ( true )
    {
        // either signal or broadcast
        if( maybe )
        {
            &lt;&lt;&lt;"signaling..."&gt;&gt;&gt;;
            e.signal();
        }
        else
          {
            &lt;&lt;&lt;"broadcasting..."&gt;&gt;&gt;;
            e.broadcast();
          }

        // advance time
        0.5::second =&gt; now;
   }
</pre>
<h2>Use
</h2> Chucking an event to now suspends the current shred, letting time advance:
<pre>    // declare Event
    Event e;

    // ...

    // wait on the event
    e =&gt; now;

    // after the event is trigger
    &lt;&lt;&lt; "I just woke up" &gt;&gt;&gt;;
</pre>
<p> As shown above, events can be triggered in two ways, depending on the desired behavior.
</p>
<pre>    // signal one shred waiting on the event e
    e.signal();
</pre>
<p> Signal() releases the first shred in that event's queue, and shredule it to run at the current time, respecting the order in which shreds were added to the queue.
</p>
<pre>    // wake up all shreds waiting on the event e
    e.broadcast();
</pre>
<p> broadcast() releases all shreds queued by that event, in the order they were added, and at the same instant in time
</p>
<p> The released shreds are shreduled to run immediately. But of course they will respect other shreds also shreduled to run at the same time. Furthermore, the shred that called signal() or broadcast() will continue to run until it advances time itself, or yield the virtual machine without advancing time. (see me.yield() under concurrency)
</p>
<h2>MIDI events
</h2> ChucK contains built-in MIDI classes to allow for interaction with MIDI based software or devices.
<pre>    MidiIn min;
    MidiMsg msg;

    // open midi receiver, exit on fail
    if ( !min.open(0) ) me.exit();

    while( true )
    {
        // wait on midi event
        min =&gt; now;

        // receive midimsg(s)
        while( min.recv( msg ) )
        {
            // print content
            &lt;&lt;&lt; msg.data1, msg.data2, msg.data3 &gt;&gt;&gt;;
        }
    }
<p> </p></pre>
<p> MidiIn is a subclass of Event, as as such can be ChucKed to now. MidiIn then takes a MidiMsg object to its .recv() method to access the MIDI data. As a default, MidiIn events trigger the broadcast() event behavior.
</p>
<h2>OSC events
</h2> In addition to MIDI, ChucK has OSC communication classes as well:
<pre>    // create our OSC receiver
    OscRecv orec;
    // port 6449
    6449 =&gt; orec.port;
    // start listening (launch thread)
    orec.listen();

    function void rate_control_shred()
    {
        // create an address in the receiver
        // and store it in a new variable.
        orec.event("/sndbuf/buf/rate,f") @=&gt; OscEvent oscdata;

        while ( true )
        {
            oscdata =&gt; now; //wait for events to arrive.

            // grab the next message from the queue.
            while( oscdata.nextMsg() != 0 )
             {
                // getFloat fetches the expected float
                // as indicated in the type string ",f"
                buf.rate( oscdata.getFloat() );
                0 =&gt; buf.pos;
             }
        }
   }
</pre>
<p> The OscRecv class listens for incoming OSC packets on the specified port. Each instance of OscRecv can create OscEvent objects using its event() method to listen for packets at any valid OSC address pattern.
</p>
<p> An OscEvent event can then be ChucKed to now to wait for messages to arrive, after which the nextMsg() and getFloatStringInt() methods can be used to fetch message data.
</p>
<h2>Creating custom events
</h2>
<p> Events, like any other class, can be subclassed to add functionality and transmit data:
</p>
<pre>    // extended event
    class TheEvent extends Event
    {
        int value;
    }

    // the event
    TheEvent e;

    // handler
    fun int hi( TheEvent event )
    {
        while( true )
         {
            // wait on event
            event =&gt; now;
            // get the data
            &lt;&lt;&gt;&gt;;
         }
     }

    // spork
    spork   hi( e );
    spork   hi( e );
    spork   hi( e );
    spork   hi( e );

    // infinite time loop
    while( true )
    {
        // advance time
        1::second =&gt; now;

        // set data
        Math.rand2( 0, 5 ) =&gt; e.value;

        // signal one waiting shred
        e.signal();
    }
</pre>
<h2>VM Wide Events
</h2> Often it can be useful to trigger events across the VM outside of the child/parent shred relationship.
<p> This can be done by declaring a reference to static data within a public class. You may only declare one public class in a file so the following must be added as two files. For more on classes see Objects reference.
</p>
<p>This example creates a VM wide event that also has communicates an int value.
</p>
<p> File 1: Extend Event to carry int value
</p>
<pre>//First Extend Event to carry int
public class E extends Event{
    int value;
}
</pre>
<p>File 2:Declare static version of extend class and instantiate once.
</p>
<pre>//Create Static Event
public class vmwEvent{
    static E @ gbEvent;
}
new E @=&gt; vmwEvent.gbEvent;
</pre>
<p>This creates the global VM wide event which can then be used as required.
</p>
<p> Write int value and broadcast event
</p>
<pre>//send values
while (true){
    Std.rand2(100,300) =&gt; vmwEvent.gbEvent.value;
    vmwEvent.gbEvent.broadcast();
    500::ms =&gt; now;
    &lt;&lt;&lt;"sent"&gt;&gt;&gt;;
}
</pre>
<p>Receive and read int value for VM wide event.
</p>
<pre>//receive values
while (true){
    vmwEvent.gbEvent =&gt; now;
    &lt;&lt;&lt; vmwEvent.gbEvent.value &gt;&gt;&gt;;
    &lt;&lt;&lt;"got"&gt;&gt;&gt;;
}
</pre>

</body></html>
   
  </div>
 </div>


  </div>
</div>
<!-- End of content -->



<!-- sputnik error page -->
<div id="dialog-sputnik-qrac" style="display: none"></div>
<div id="dialog-sputnik-error" title="Can't communicate with booktype">
  <p>
    <span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
    There has been error in communication with Booktype server.
    Not sure right now where is the problem.
  </p>
  <p>
    You should refresh this page.
  </p>
</div>


<ul class="strings template">
 <li class="ok">OK</li>
 <li class="back">Back</li>
 <li class="create">Create</li>
 <li class="cancel">Cancel</li>
 <li class="next">Next</li>
 <li class="import">Import</li>
 <li class="savechanges">Save changes</li>
 <li class="errorcreategroup">Couldn't create a group!</li>
 <li class="msgepub">enter epub URL</li>
 <li class="msgarchive">enter Archive.org ID</li>
 <li class="msgwiki">enter Wikibooks URL</li>
 <li class="msgbooktype">enter Booktype URL</li>
 <li class="deletebook">Delete book</li>
</ul>

</body>
</html>

