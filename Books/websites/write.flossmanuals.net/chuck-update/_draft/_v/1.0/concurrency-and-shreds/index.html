
<!DOCTYPE HTML>
<html>
 <head>
   

<link type="text/css" href="/site_static/css/booki.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/base/jquery.ui.all.css" rel="Stylesheet" >
<link type="text/css" href="/site_static/js/jquery/themes/smoothness/jquery.ui.all.css" rel="Stylesheet" >
<script type="text/javascript" src="/site_static/js/jquery/jquery-1.4.4.js"></script>
<script type="text/javascript" src="/site_static/js/jquery/ui/jquery-ui-1.8.10.custom.js"></script>
<script type="text/javascript" src="/site_static/js/jquery.json-1.3.js"></script>
<script type="text/javascript" src="/site_static/js/booki.js"></script>
<script src="/site_static/js/messaging.js" type="text/javascript"></script>   
<script type="text/javascript" src="/site_static/js/general.js"></script>
<link href="/site_static/css/jquery.bubblepopup.v2.3.1.css" rel="stylesheet" type="text/css" />
<link type="text/css" href="/site_static/css/jquery-ui_overrides.css" rel="Stylesheet" >
<script src="/site_static/js/jquery.bubblepopup.v2.3.1.min.js" type="text/javascript"></script>

<link rel="SHORTCUT ICON" href="http://write.flossmanuals.net/site_static/images/favicon.ico" type="image/x-icon">
<meta property="og:site_name" content="FLOSS Manuals"/><meta name="description" content="Free Manuals for Freedom"/>

<script type="text/javascript">
  $(function() {
      $.booki.sputnikDispatcherURL = "/_sputnik/";

      $("#dialog-sputnik-error").dialog({
          modal: true,
          autoOpen: false,
          buttons: {
            Ok: function() {
               $(this).dialog('close');
               window.location = '.';
            }
          }
      });
  
      $("FORM.messagefield").messagefield('init', {'view_post': '/messaging/post' });  
  });
</script>


   
 <title>/chapter: Concurrency-And-Shreds / chuck update</title>
 <link type="text/css" href="/site_static/css/draft.css" rel="Stylesheet" />

 <link rel="alternate" type="application/rss+xml" title="RSS feed for chuck update" href="/feeds/rss/book/chuck-update/" /> 
 <link rel="alternate" type="application/atom+xml" title="Atom feed for chuck update" href="/feeds/atom/book/chuck-update/" /> 

 <link rel="alternate" type="application/rss+xml" title="RSS feed for chapter Concurrency and Shreds" href="/feeds/rss/chapter/chuck-update/chuck-update/" /> 
 <link rel="alternate" type="application/atom+xml" title="Atom feed for chapter Concurrency and Shreds" href="/feeds/atom/chapter/chuck-update/chuck-update/" /> 
 
 <script type="text/javascript" src="/site_static/js/draft.js"></script>


   <link type="text/css" href="/static/css/_user.css" rel="Stylesheet" >
 </head>
<body>

<div class="topbar"> 
  <div class="logotext"><a href="http://write.flossmanuals.net/">FLOSS Manuals</a> </div>

  <div class="meta-bar">
    
    <ul>
      <li>
        <a href="/accounts/signin/?redirect=/chuck-update/_draft/_v/1.0/concurrency-and-shreds/">Sign In / Create Account</a>
      </li>
    </ul>
    
    <div style="padding-top: 10px; padding-right: 15px;">
      <br/>
      

<script>
  $(function() {
    var $frm = $("FORM[name=changelang]");
	
    $("A[href=#]", $frm).click(function() {
        var lang = $(this).attr("class").substr(4);
	
        $("INPUT[name=language]", $frm).val(lang);
        $frm.submit();
	
        return false;
    });
  });
 </script>

<form name="changelang" method="POST" action="/accounts/i18n/setlang/?language=en-us">
  <input type="hidden" name="language" value="en-us">
  
    &nbsp;English&nbsp;|
  
  
  
    &nbsp;<a class="langes" href="#">Español</a>&nbsp;|
  

  
    &nbsp;<a class="langfr" href="#">Français</a>&nbsp;|
  
	
  
    &nbsp;<a class="langit" href="#">Italiano</a>&nbsp;|
  
	
  
    &nbsp;<a class="langpt" href="#">Português</a>&nbsp;|
  
	
  
    &nbsp;<a class="langru" href="#">Русский</a>&nbsp;|
  
	
  
    &nbsp;<a class="langsq" href="#">Shqip</a>
  	
</form>

    </div>
    
    
  </div><!-- End of .meta-bar -->
</div><!-- End top bar -->

<div class="menubar shadow">
  
  
  <div class="navbox">
    <ul>
      <li><a href="/list-books/">Books</a></li>
      <li><a href="/list-groups/">Groups</a></li>
      <li><a href="/list-people/">People</a></li>
    </ul>      
  </div><!-- End of .navbox -->       
</div>

<div class="content-container">
  <div class="content shadow">
    <!-- Content box and the drop shadow-->
    

<h2>chuck update</h2>
<div class="padded">
 <div id="bookmenu" style="background: url(/site_static/images/draft_bg.png) repeat !important;"> 
  <ul>
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/introduction/">Introduction</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/places/">Places</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/authors/">Authors</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/installation/">Installation</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/tutorials/">Tutorials</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/hello-chuck/">Hello ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/conventions/">Conventions</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/on-the-fly-programming/">On-the-fly Programming</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/modifying-basic-patches/">Modifying Basic Patches</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/lfos-and-blackholes/">LFOs and Blackholes</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/working-with-midi/">Working with MIDI</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/writing-to-disk/">Writing to Disk</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/stereo/">Stereo</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/using-osc-in-chuck/">Using OSC in ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/reference/">Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/overview/">Overview</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/the-chuck-compiler-and-virtual-machine/">The ChucK Compiler and Virtual Machine</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/on-the-fly-commands/">On-the-fly Commands</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/types-values-and-variables/">Types, Values and Variables</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/operators-and-operations/">Operators and Operations</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/time-and-timing/">Time and Timing</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/concurrency-and-shreds/">Concurrency and Shreds</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/events/">Events</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/control-structures/">Control Structures</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/functions/">Functions</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/objects/">Objects</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/arrays/">Arrays</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-analyzers/">Unit Analyzers</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/standard-libraries/">Standard Libraries</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/event-reference/">Event Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/other-objects-reference/">Other Objects Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugenreference/">UgenReference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-generators/">Unit Generators</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugens-oscillators/">Ugens: Oscillators</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/ugens-stkinstruments/">Ugens: STKInstruments</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/unit-analyzer-reference/">Unit Analyzer Reference</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/extending-chuck/">Extending ChucK</a></li>
    
   
    
      <li><a href="/chuck-update/_draft/_v/1.0/lick-library-for-chuck/">LiCK: Library for ChucK</a></li>
    
   
  </ul>
 </div>
 <div id="bookcontent"   style="background: url(/site_static/images/draft_bg.png) repeat !important;">
   

  <html lang="en"><head><title>Concurrency and Shreds</title></head><body><h1>Concurrency and Shreds
</h1>
<p>ChucK is able to run many processes concurrently (the process behave as though they were running in parallel). A ChucKian process is called a "shred". "Sporking" a shred means creating and adding a new process to the virtual machine. Shreds may be sporked from a variety of places, and may themselves spork new shreds.
</p>
<p>Central to ChucK's timing and concurrency is the "shreduler", a part of the virtual machine that keeps track of what processes are intended (or "shreduled") to run at any geven time. It does so to a very high precision, much more accurate than the sample rate. This is not just because things need to happen at the right time; they also need to happen in the right order. In ChucK the order in which commands are executed is always deterministic; when several commands are shreduled to happen at the same time they will be dealt with in the order in which they were shreduled. Note that any given process/shred does not necessarily need to know about any other - it only has to deal with time locally. The virtual machine will make sure things happen correctly ”across the board”. 
</p>
<p>The simplest way to to run shreds concurrently is to specify them on the command line:
</p>
<pre>%&gt;chuck foo.ck bar.ck boo.ck</pre>
<p>The above command tells chuck to run foo.ck, bar.ck, and boo.ck concurrently. There are other ways to run shreds concurrently (see on-the-ﬂy programming commands). Next, we show how to create new shreds from within ChucK programs.
</p>
<h2>Sporking Shreds (In Code)
</h2>
<p>To spork means to shredule a new shred.
</p>
<p>To spork a shred, use the spork keyword/operator:
</p>
<ul><li>Spork dynamically turns functions into processes that run parallel to the shred that sporked them
  <br></li>
  <li>This new shred is shreduled to execute immediately</li>
  <li>The parent shred continues to execute, until time is advanced (see manipulating time) or until the parent explicitly yields (see next section).</li>
  <li>In the current implementation, when a parent shred exits, all child shreds all exit (this behavior will be enhanced in the future.)</li>
  <li>Sporking a function returns a reference to the new shred, note that this operation does not return a function's return value, currently only functions of type void can be sporked - the ability to get back the return value at some later point in time will be provided in a future release.</li>
</ul><pre>// define function go()
fun void go()
{
  // insert code
}
// spork a new shred to start running from go()
spork ~ go();

// spork another, store reference to new shred in offspring
spork ~ go() =&gt; Shred @ offspring;
</pre>
<p>A slightly longer example:
</p>
<pre>// define function
fun void foo( string s )
{
  // infinite time loop
  while( true )
  {
    // print s
    &lt;&lt;&lt; s &gt;&gt;&gt;;

    // advance time
    500::ms =&gt; now;
  }
}

// spork shred, passing in "you" as argument to foo
spork ~ foo( "you" );

// advance time by 250 ms
250::ms =&gt; now;

// spork another shred
spork ~ foo( "me" );

// infinite time loop - to keep child shreds around
while( true )
  1::second =&gt; now;
</pre>
<p>also see the function section for more information on working with functions.
</p>
<h2>The ’me’ keyword
</h2>
<p>The me keyword (type Shred) refers the current shred.
</p>
<p>Sometimes it is useful to suspend the current shred without advancing time, and give other shreds shreduled for the current time a chance to execute. me.yield() does exactly that. This is often useful immediately after sporking a new shred, when you would like for the new shred to have a chance to run but you do not want to advance time yet for yourself.
</p>
<pre>// spork shred
spork ~ go();

// suspend the current shred ...
// ... give other shreds (shreduled for ’now’) a chance to run
me.yield();</pre>
<p>The me keyword is also useful to exit the current shred. For example if a MIDI device fails to open, you may exit the current shred.
</p>
<pre>// make a MidiIn object
MidiIn min;

// try to open device 0 (chuck --probe to list all device)
if( !min.open( 0 ) )
{
  // print error message
  &lt;&lt;&lt; "can’t open MIDI device" &gt;&gt;&gt;;

  // exit the current shred
  me.exit();
}
</pre>
<p>Finally it can be used to get the shred id:
</p>
<pre>// print out the shred id
&lt;&lt;&lt; me.id(); &gt;&gt;&gt;;
</pre>
<p>These functions are common to all shreds, but note that yield() can only be used from within the current shred.
</p>
<h2>using Machine.add()
</h2>
<p>Machine.add( string path ) takes the path to a chuck program, and sporks it. Unlike with the spork command, there is no parent-child relationship between the shred that calls the function and the new shred that is added. This is useful for dynamically running stored programs.
</p>
<pre>// spork "foo.ck"
Machine.add( "foo.ck" ); </pre>
<p>Presently, this returns the id of the new shred, not a reference to the shred. This will likely be changed in the future.
</p>
<p>Similarly, you can remove shreds from the virtual machine.
</p>
<pre>// add
Machine.add( "foo.ck" ) =&gt; int id;

// remove shred with id
Machine.remove( id );

// add
Machine.add( "boo.ck" ) =&gt; id

// replace shred with "bar.ck"
Machine.replace( id, "bar.ck" );</pre>
<h2>Inter-Shred Communication
</h2>
<p>Shreds sporked in the same ﬁle can share the same global variables. They can use time and events to synchronize to each other (see Events). Shreds sporked from different ﬁles can share data (including events). For now, this is done through a public class with static data (see Classes). Static data is not completely implemented, We will ﬁx this very soon!
</p>

</body></html>
   
  </div>
 </div>


  </div>
</div>
<!-- End of content -->



<!-- sputnik error page -->
<div id="dialog-sputnik-qrac" style="display: none"></div>
<div id="dialog-sputnik-error" title="Can't communicate with booktype">
  <p>
    <span class="ui-icon ui-icon-circle-check" style="float:left; margin:0 7px 50px 0;"></span>
    There has been error in communication with Booktype server.
    Not sure right now where is the problem.
  </p>
  <p>
    You should refresh this page.
  </p>
</div>


<ul class="strings template">
 <li class="ok">OK</li>
 <li class="back">Back</li>
 <li class="create">Create</li>
 <li class="cancel">Cancel</li>
 <li class="next">Next</li>
 <li class="import">Import</li>
 <li class="savechanges">Save changes</li>
 <li class="errorcreategroup">Couldn't create a group!</li>
 <li class="msgepub">enter epub URL</li>
 <li class="msgarchive">enter Archive.org ID</li>
 <li class="msgwiki">enter Wikibooks URL</li>
 <li class="msgbooktype">enter Booktype URL</li>
 <li class="deletebook">Delete book</li>
</ul>

</body>
</html>

